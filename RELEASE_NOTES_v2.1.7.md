# 📢 SLMC日次報告書作成システム v2.1.7 リリースノート

**リリース日**: 2025年11月22日  
**バージョン**: v2.1.7  
**前バージョン**: v2.1.6

---

## 🎉 主な新機能

### 1. Webメール完全対応 ✉️

**問題**:
- メールソフトがインストールされていない環境で送信できない
- Gmail/Outlook.comのWeb版ユーザーが不便

**解決**:
- Gmail/Outlook.comのブラウザ版から直接送信可能に

**新機能**:
- ✅ **Gmailで開く**ボタン：GmailのWeb版で新規メール作成
- ✅ **Outlook.comで開く**ボタン：Outlook.comのWeb版で新規メール作成
- ✅ **メールソフトで開く**ボタン：従来のmailto:方式（Outlook/Thunderbird等）
- ✅ **クリップボードにコピー**ボタン：レポートをコピーして手動で貼り付け
- ✅ 文字数チェック機能：レポートが長い場合に警告表示

**メリット**:
- メールソフト不要で、どの環境でも送信可能
- Webメール利用者の利便性が大幅向上
- 長いレポートでもクリップボードコピーで対応可能

---

### 2. システム内マニュアル閲覧 📖

**問題**:
- マニュアルが別ファイルで管理が煩雑
- 操作中にマニュアルを確認するのが不便

**解決**:
- ダッシュボードからワンクリックでマニュアル表示

**新機能**:
- ✅ ダッシュボードに「マニュアル」ボタン追加
- ✅ モーダルウィンドウでマニュアル表示
- ✅ v2.1.7の全機能を網羅した完全版マニュアル
- ✅ 目次ナビゲーション付き
- ✅ レスポンシブ対応（PC/タブレット/スマホ）

**メリット**:
- 別ファイルを開く手間なし
- いつでもすぐに操作方法を確認可能
- システムとマニュアルが統合され使いやすい

---

### 3. 複数レポート一括ZIP出力 📦

**問題**:
- 複数のレポートを個別にダウンロードする手間
- 週次報告時に複数ファイルを配布するのが面倒

**解決**:
- 必要なレポートを選択してZIPでまとめてダウンロード

**新機能**:
- ✅ チェックボックスで出力項目を選択
  - 日次レポート
  - 週次レポート
  - 月次レポート
  - 累計レポート
  - CSV（全データ）
- ✅ 1つのZIPファイルにまとめてダウンロード
- ✅ ファイル名に日付とブロック名を自動付与
- ✅ JSZipライブラリによる高速ZIP生成

**メリット**:
- 複数レポートを効率的に管理
- 複数人への配布が簡単（ZIPファイル1つで完結）
- ダウンロード時間の短縮

**使用例**:
```
週次報告時：
✓ 週次レポート
✓ CSV
→ 「SLMC日次報告_一括出力_東ブロック_2025-11-22.zip」
```

---

### 4. ドラッグ&ドロップインポート 🎯

**問題**:
- ファイル選択ダイアログが使いにくい
- CSV/ZIP形式でのインポートができない

**解決**:
- ドラッグ&ドロップで簡単にインポート
- 複数形式に対応

**新機能**:
- ✅ **ドラッグ&ドロップエリア**：ファイルをドラッグするだけでインポート
- ✅ **ZIP対応**：ZIPファイルを直接インポート（自動解凍）
- ✅ **CSV対応**：CSVファイルからインポート可能
- ✅ **JSON対応**：従来通りJSONファイルもサポート
- ✅ 自動形式判定：ファイル拡張子を自動判別
- ✅ ドラッグオーバー時の視覚フィードバック

**メリット**:
- インポート操作が直感的に
- バックアップファイルの復元が簡単
- CSVファイルから直接データを移行可能
- 視覚的に分かりやすいUI

**対応形式**:
| 形式 | 拡張子 | 説明 |
|------|--------|------|
| JSON | .json | 従来形式（完全互換） |
| CSV | .csv | Excel等から出力したCSV |
| ZIP | .zip | JSON/CSVを含むZIPファイル |

---

## 🔧 技術的な改善

### HTML
- JSZipライブラリをCDNから追加（v3.10.1）
- メール送信モーダルのUI改善
- ドラッグ&ドロップエリアの追加
- マニュアルモーダルの追加
- 一括エクスポートセクションの追加

### CSS
- Webメールボタンのスタイル追加（Gmail/Outlook.comカラー）
- ドラッグ&ドロップエリアのスタイル追加
- drag-overクラスでドラッグ時のフィードバック
- マニュアルモーダルのフルスクリーンスタイル
- 一括エクスポートチェックボックスのスタイル

### JavaScript
- `sendGmail()`: Gmail Web版で開く
- `sendOutlook()`: Outlook.com Web版で開く
- `copyToClipboard()`: クリップボードコピー機能
- `getEmailData()`: メールデータ取得の共通処理
- `openManual()` / `closeManual()`: マニュアル表示制御
- `downloadBatchZip()`: 一括ZIP出力機能
- `generateCSVContent()`: CSV生成の共通処理
- `processImportFile()`: インポートファイル処理
- `processJSONFile()` / `processCSVFile()` / `processZIPFile()`: 各形式の処理
- `parseCSV()`: CSV解析機能
- `parseCSVLine()`: CSVライン解析（カンマ、ダブルクォート対応）

---

## 📝 変更されたファイル

### 新規作成:
1. **manual_v2.1.7.html** - 完全版マニュアルHTML
2. **RELEASE_NOTES_v2.1.7.md** - 本リリースノート

### 更新:
1. **index.html**
   - JSZipライブラリ追加
   - メール送信モーダルのボタン変更
   - マニュアルモーダル追加
   - ドラッグ&ドロップエリア追加
   - 一括エクスポートセクション追加

2. **css/style.css**
   - Webメールボタンスタイル追加
   - ドラッグ&ドロップエリアスタイル追加
   - マニュアルモーダルスタイル追加
   - 一括エクスポートスタイル追加

3. **js/app.js** (v2.1.6 → v2.1.7)
   - Webメール送信機能追加
   - マニュアル表示機能追加
   - 一括ZIP出力機能追加
   - ドラッグ&ドロップインポート機能追加
   - CSV/ZIP形式インポート対応

4. **README.md**
   - v2.1.7の新機能を追加
   - バージョン履歴更新

---

## ✅ 動作確認項目

### Webメール送信のテスト
1. ✅ レポート生成後にメール送信ボタンが表示される
2. ✅ 複数の送信先を選択できる
3. ✅ 「Gmailで開く」ボタンでGmail Web版が開く
4. ✅ 「Outlook.comで開く」ボタンでOutlook.comが開く
5. ✅ 「メールソフトで開く」ボタンでメールソフトが起動する
6. ✅ 「クリップボードにコピー」ボタンでコピーできる
7. ✅ 宛先、件名、本文が正しく設定される

### マニュアル閲覧のテスト
1. ✅ ダッシュボードに「マニュアル」ボタンが表示される
2. ✅ ボタンをクリックするとモーダルが開く
3. ✅ マニュアルが正しく表示される
4. ✅ 目次リンクが機能する
5. ✅ 閉じるボタンで閉じる

### 一括ZIP出力のテスト
1. ✅ レポートタブに一括エクスポートセクションが表示される
2. ✅ チェックボックスで項目を選択できる
3. ✅ 「選択項目をZIPでダウンロード」ボタンが機能する
4. ✅ ZIPファイルがダウンロードされる
5. ✅ ZIP内に選択したファイルが含まれている
6. ✅ ファイル名が正しい（日付、ブロック名含む）

### ドラッグ&ドロップインポートのテスト
1. ✅ インポートモーダルにドラッグ&ドロップエリアが表示される
2. ✅ ファイルをドラッグすると視覚的にフィードバックがある
3. ✅ JSONファイルをドロップしてインポートできる
4. ✅ CSVファイルをドロップしてインポートできる
5. ✅ ZIPファイルをドロップしてインポートできる
6. ✅ プレビューが正しく表示される
7. ✅ 重複データが検出される
8. ✅ インポートモード（追加/置き換え）が機能する

---

## 🚀 アップグレード方法

### GitHub Pagesで公開している場合:

1. **ファイルをダウンロード**
   - Genspark画面下部の「Download files」ボタンをクリック
   - ZIPファイルをダウンロード・解凍

2. **GitHubで更新**
   - 以下のファイルを更新：
     - `index.html`
     - `css/style.css`
     - `js/app.js`
     - `README.md`
   - 以下のファイルを新規追加：
     - `manual_v2.1.7.html`
     - `RELEASE_NOTES_v2.1.7.md`

3. **ブラウザのキャッシュをクリア**
   - Mac Chrome: `Cmd + Shift + R`
   - Windows Chrome: `Ctrl + Shift + R`

4. **動作確認**
   - ダッシュボードにマニュアルボタンが表示されるか
   - メール送信で4つのボタンが表示されるか
   - レポートタブに一括エクスポートセクションが表示されるか
   - インポートモーダルにドラッグ&ドロップエリアが表示されるか

---

## 📊 互換性

### ブラウザ対応
- ✅ Chrome 90+ (推奨)
- ✅ Edge 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ モバイルブラウザ（iOS Safari, Chrome Mobile）

### データ互換性
- ✅ v2.1.6以前のデータ完全互換
- ✅ 既存のJSONバックアップファイル使用可能
- ✅ CSVファイルからのインポートに対応

---

## 🐛 既知の問題

### 1. レポートが非常に長い場合
- Gmail/Outlook.comのURL長さ制限（約2000文字）により、一部が切れる可能性
- **回避策**: 「クリップボードにコピー」ボタンを使用して手動で貼り付け

### 2. 大きなZIPファイルのインポート
- 20MB以上のZIPファイルはブラウザが遅くなる可能性
- **推奨**: データを分割してインポート

### 3. ブラウザのポップアップブロッカー
- Gmail/Outlook.comボタンがポップアップブロッカーで阻止される場合がある
- **回避策**: ポップアップを許可する、または「クリップボードにコピー」を使用

---

## 📞 サポート

ご不明な点やバグ報告は、システム管理者までお問い合わせください。

---

## 🎊 まとめ

### v2.1.7で追加された機能:
✅ **Webメール対応** - Gmail/Outlook.comから直接送信  
✅ **システム内マニュアル** - ダッシュボードからワンクリック  
✅ **一括ZIP出力** - 複数レポートをまとめてダウンロード  
✅ **ドラッグ&ドロップ** - ZIP/CSV/JSON対応の簡単インポート  

### 既存機能（引き続き利用可能）:
✅ マルチブロック対応（4ブロック）  
✅ 複数メール送信（チェックボックス選択）  
✅ 週次・月次・累計レポートの期間合計表示  
✅ CSVエクスポート  
✅ データ編集・削除  
✅ 月累計自動計算  
✅ 前日データコピー  

---

**🎊 Version 2.1.7 をお楽しみください！**

ユーザーの要望に基づき、さらなる機能追加を検討しています。
フィードバックをお待ちしております。
