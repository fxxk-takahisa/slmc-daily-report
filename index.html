<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLMC日次報告書作成システム</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-file-alt"></i> SLMC日次報告書作成システム</h1>
            <p class="subtitle">Multi-Block Daily Report Management System</p>
        </header>

        <!-- ブロック選択ダッシュボード -->
        <div id="block-dashboard" class="block-dashboard">
            <h2><i class="fas fa-th-large"></i> ブロック選択</h2>
            <p class="dashboard-subtitle">報告するブロックを選択してください</p>
            
            <div class="block-grid">
                <div class="block-card" data-block="east">
                    <h3>東ブロック</h3>
                    <p>East Block</p>
                    <button class="btn btn-primary block-select-btn" onclick="app.selectBlock('east')">
                        <i class="fas fa-arrow-right"></i> 選択
                    </button>
                </div>
                
                <div class="block-card" data-block="center">
                    <h3>センターブロック</h3>
                    <p>Center Block</p>
                    <button class="btn btn-primary block-select-btn" onclick="app.selectBlock('center')">
                        <i class="fas fa-arrow-right"></i> 選択
                    </button>
                </div>
                
                <div class="block-card" data-block="west">
                    <h3>西ブロック</h3>
                    <p>West Block</p>
                    <button class="btn btn-primary block-select-btn" onclick="app.selectBlock('west')">
                        <i class="fas fa-arrow-right"></i> 選択
                    </button>
                </div>
                
                <div class="block-card" data-block="dcl">
                    <h3>DCL共通</h3>
                    <p>DCL Common</p>
                    <button class="btn btn-primary block-select-btn" onclick="app.selectBlock('dcl')">
                        <i class="fas fa-arrow-right"></i> 選択
                    </button>
                </div>
                
                <div class="block-card" data-block="manual">
                    <h3>マニュアル</h3>
                    <p>User Manual</p>
                    <button class="btn btn-info block-select-btn" onclick="app.openManual()">
                        <i class="fas fa-book"></i> 閲覧
                    </button>
                </div>
            </div>
        </div>

        <!-- メインコンテンツ（ブロック選択後に表示） -->
        <div id="main-content" class="main-content" style="display: none;">
            <!-- ブロック表示ヘッダー -->
            <div class="current-block-header">
                <div class="current-block-info">
                    <span class="block-label">現在のブロック:</span>
                    <span id="current-block-name" class="block-name"></span>
                </div>
                <button class="btn btn-secondary" onclick="app.returnToDashboard()">
                    <i class="fas fa-th-large"></i> ブロック選択に戻る
                </button>
            </div>

            <nav class="tab-navigation">
                <button class="tab-btn active" data-tab="input">
                    <i class="fas fa-edit"></i> データ入力
                </button>
                <button class="tab-btn" data-tab="report">
                    <i class="fas fa-chart-bar"></i> レポート
                </button>
                <button class="tab-btn" data-tab="data">
                    <i class="fas fa-database"></i> データ管理
                </button>
                <button class="tab-btn" data-tab="settings">
                    <i class="fas fa-cog"></i> メール設定
                </button>
            </nav>

            <!-- データ入力タブ -->
            <div id="input-tab" class="tab-content active">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-keyboard"></i> 日次データ入力</h2>
                        <button id="copyPrevDay" class="btn btn-secondary">
                            <i class="fas fa-copy"></i> 前日データをコピー
                        </button>
                    </div>
                    
                    <!-- 動的に生成されるフォーム -->
                    <div id="dynamic-form-container"></div>
                </div>
            </div>

            <!-- レポートタブ -->
            <div id="report-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-chart-bar"></i> レポート生成</h2>
                    </div>

                    <div class="report-controls">
                        <div class="report-type-selector">
                            <button class="report-type-btn active" data-type="daily">
                                <i class="fas fa-calendar-day"></i> 日次レポート
                            </button>
                            <button class="report-type-btn" data-type="weekly">
                                <i class="fas fa-calendar-week"></i> 週次レポート
                            </button>
                            <button class="report-type-btn" data-type="monthly">
                                <i class="fas fa-calendar-alt"></i> 月次レポート
                            </button>
                            <button class="report-type-btn" data-type="cumulative">
                                <i class="fas fa-calendar-check"></i> 累計レポート
                            </button>
                        </div>

                        <!-- 日次レポート設定 -->
                        <div id="daily-settings" class="report-settings active">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="dailyReportDate">レポート日付</label>
                                    <input type="date" id="dailyReportDate">
                                </div>
                            </div>
                        </div>

                        <!-- 週次レポート設定 -->
                        <div id="weekly-settings" class="report-settings">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="weeklyStartDate">週の開始日（月曜日）</label>
                                    <input type="date" id="weeklyStartDate">
                                </div>
                            </div>
                        </div>

                        <!-- 月次レポート設定 -->
                        <div id="monthly-settings" class="report-settings">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="monthlyYear">年</label>
                                    <input type="number" id="monthlyYear" min="2020" max="2099" value="2025">
                                </div>
                                <div class="form-group">
                                    <label for="monthlyMonth">月</label>
                                    <select id="monthlyMonth">
                                        <option value="1">1月</option>
                                        <option value="2">2月</option>
                                        <option value="3">3月</option>
                                        <option value="4">4月</option>
                                        <option value="5">5月</option>
                                        <option value="6">6月</option>
                                        <option value="7">7月</option>
                                        <option value="8">8月</option>
                                        <option value="9">9月</option>
                                        <option value="10">10月</option>
                                        <option value="11">11月</option>
                                        <option value="12">12月</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- 累計レポート設定 -->
                        <div id="cumulative-settings" class="report-settings">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="cumulativeStartDate">開始日</label>
                                    <input type="date" id="cumulativeStartDate">
                                </div>
                                <div class="form-group">
                                    <label for="cumulativeEndDate">終了日</label>
                                    <input type="date" id="cumulativeEndDate">
                                </div>
                            </div>
                        </div>

                        <div class="batch-export-section">
                            <h4><i class="fas fa-archive"></i> 一括エクスポート</h4>
                            <p class="batch-export-description">複数のレポートタイプとCSVをまとめてZIPファイルでダウンロードできます</p>
                            <div class="batch-export-checkboxes">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="exportDailyReport" checked>
                                    <span>日次レポート</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="exportWeeklyReport" checked>
                                    <span>週次レポート</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="exportMonthlyReport" checked>
                                    <span>月次レポート</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="exportCumulativeReport" checked>
                                    <span>累計レポート</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="exportCSV" checked>
                                    <span>CSV</span>
                                </label>
                            </div>
                            <button id="downloadBatchZip" class="btn btn-warning">
                                <i class="fas fa-file-archive"></i> 選択項目をZIPでダウンロード
                            </button>
                        </div>

                        <div class="form-actions">
                            <button id="generateReport" class="btn btn-primary">
                                <i class="fas fa-file-export"></i> レポート生成
                            </button>
                            <button id="downloadReport" class="btn btn-secondary">
                                <i class="fas fa-download"></i> テキストダウンロード
                            </button>
                            <button id="sendEmail" class="btn btn-success" style="display:none;">
                                <i class="fas fa-envelope"></i> メール送信
                            </button>
                            <button id="downloadCSV" class="btn btn-secondary">
                                <i class="fas fa-file-csv"></i> CSVダウンロード
                            </button>
                        </div>
                    </div>

                    <div id="reportOutput" class="report-output"></div>

                    <!-- グラフ表示エリア -->
                    <div class="chart-container">
                        <h3><i class="fas fa-chart-line"></i> 推移グラフ</h3>
                        <div class="chart-grid">
                            <div class="chart-box">
                                <canvas id="netIncreaseChart"></canvas>
                            </div>
                            <div class="chart-box">
                                <canvas id="vcClubExChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- データ管理タブ -->
            <div id="data-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-database"></i> データ管理</h2>
                        <div class="header-actions">
                            <button id="importData" class="btn btn-primary">
                                <i class="fas fa-file-import"></i> データインポート
                            </button>
                            <button id="exportAllData" class="btn btn-secondary">
                                <i class="fas fa-file-export"></i> 全データエクスポート
                            </button>
                        </div>
                    </div>

                    <div class="data-search">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="searchBlock">ブロック</label>
                                <select id="searchBlock">
                                    <option value="">全てのブロック</option>
                                    <option value="east">東ブロック</option>
                                    <option value="center">センターブロック</option>
                                    <option value="west">西ブロック</option>
                                    <option value="dcl">DCL共通</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="searchStartDate">開始日</label>
                                <input type="date" id="searchStartDate">
                            </div>
                            <div class="form-group">
                                <label for="searchEndDate">終了日</label>
                                <input type="date" id="searchEndDate">
                            </div>
                            <div class="form-group">
                                <button id="searchData" class="btn btn-primary">
                                    <i class="fas fa-search"></i> 検索
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="dataList" class="data-list"></div>
                </div>
            </div>

            <!-- 設定タブ -->
            <div id="settings-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-cog"></i> メール送信設定</h2>
                    </div>

                    <div class="settings-section">
                        <h3><i class="fas fa-envelope"></i> メールアドレス管理</h3>
                        <p class="settings-description">レポート送信先のメールアドレスを登録・管理します。</p>
                        
                        <div class="email-add-section">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="emailName">送信先名</label>
                                    <input type="text" id="emailName" placeholder="例: PCD日次報告">
                                </div>
                                <div class="form-group">
                                    <label for="emailAddress">メールアドレス</label>
                                    <input type="email" id="emailAddress" placeholder="例: honbu@example.com">
                                </div>

                                <div class="form-group">
                                    <button id="addEmail" class="btn btn-primary">
                                        <i class="fas fa-plus"></i> 追加
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div id="emailList" class="email-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- メール送信モーダル -->
    <div id="emailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-envelope"></i> メール送信</h3>
                <span class="close" onclick="app.closeEmailModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>送信先を選択（複数選択可能）</label>
                    <div id="emailRecipientList" class="email-recipient-list">
                        <!-- チェックボックスが動的に生成されます -->
                    </div>
                    <small class="form-text text-muted">選択した全員に同時送信されます</small>
                </div>
                <div class="form-group">
                    <label>件名</label>
                    <input type="text" id="emailSubject" class="form-control" readonly>
                </div>
                <div class="form-group">
                    <label>本文プレビュー</label>
                    <textarea id="emailBody" class="form-control" rows="10" readonly></textarea>
                </div>
                <div class="email-notice">
                    <i class="fas fa-info-circle"></i>
                    <strong>メール送信方法を選択してください：</strong>
                </div>
                <div class="form-actions">
                    <div class="email-button-group">
                        <button id="sendGmailBtn" class="btn btn-gmail">
                            <i class="fab fa-google"></i> Gmail で開く
                        </button>
                        <button id="sendOutlookBtn" class="btn btn-outlook">
                            <i class="fab fa-microsoft"></i> Outlook.com で開く
                        </button>
                        <button id="sendEmailBtn" class="btn btn-success">
                            <i class="fas fa-envelope"></i> メールソフトで開く
                        </button>
                    </div>
                    <button id="copyToClipboard" class="btn btn-secondary" style="margin-top: 10px;">
                        <i class="fas fa-copy"></i> クリップボードにコピー
                    </button>
                    <button onclick="app.closeEmailModal()" class="btn btn-secondary" style="margin-top: 10px;">
                        <i class="fas fa-times"></i> キャンセル
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- データ編集モーダル -->
    <div id="editModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> データ編集</h3>
                <span class="close close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div id="editFormContainer"></div>
                <div class="form-actions">
                    <button onclick="app.saveEdit()" class="btn btn-success">
                        <i class="fas fa-save"></i> 保存
                    </button>
                    <button class="btn btn-secondary close-modal">
                        <i class="fas fa-times"></i> キャンセル
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- データインポートモーダル -->
    <div id="importModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-file-import"></i> データインポート</h3>
                <span class="close close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div id="dropZone" class="drop-zone">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h4>ファイルをドラッグ&ドロップ</h4>
                    <p>または</p>
                    <label for="importFileInput" class="file-select-btn">
                        <i class="fas fa-folder-open"></i> ファイルを選択
                    </label>
                    <input type="file" id="importFileInput" accept=".json,.csv,.zip" style="display: none;">
                    <div id="importFileName" class="file-name">JSON, CSV, ZIPファイルに対応</div>
                </div>
                
                <div id="importPreview" class="import-preview" style="display: none;"></div>
                
                <div id="importActions" class="import-actions" style="display: none;">
                    <div class="import-mode-select">
                        <h4><i class="fas fa-cog"></i> インポートモード</h4>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="importMode" value="add" checked>
                                <div class="radio-content">
                                    <div class="radio-title">追加モード</div>
                                    <div class="radio-description">既存データを保持して新規データを追加します（重複はスキップ）</div>
                                </div>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="importMode" value="replace">
                                <div class="radio-content">
                                    <div class="radio-title">置き換えモード</div>
                                    <div class="radio-description">既存の全データを削除して、インポートデータに置き換えます</div>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button id="executeImport" class="btn btn-success">
                            <i class="fas fa-check"></i> インポート実行
                        </button>
                        <button class="btn btn-secondary close-modal">
                            <i class="fas fa-times"></i> キャンセル
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- マニュアルモーダル -->
    <div id="manualModal" class="modal">
        <div class="modal-content modal-fullscreen">
            <div class="modal-header">
                <h3><i class="fas fa-book"></i> 操作マニュアル</h3>
                <span class="close" onclick="app.closeManual()">&times;</span>
            </div>
            <div class="modal-body">
                <iframe id="manualFrame" style="width: 100%; height: calc(100vh - 150px); border: none;"></iframe>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>